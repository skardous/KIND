@(id: Long, eventForm: Form[Evenement], event: Evenement)

@import helper._

@implicitFieldConstructor = @{ FieldConstructor(twitterBootstrapInput.render) }


@main("Selectionner les jours") {

	<h2>Selectionner les jours:</h2>

	<div class="control-group"><label class="control-label"><b>Titre:&nbsp;</b></label> @event.titre </div> <br>

	<label class="control-label"><b>Date</b></label> <div class="controls" id="date"></div>

	OU<br>

	Ajouter une date particulière: (ex: tous les jeudis)<br>
	<input class="particuliere" type="text"> <a id="okParticuliere" class="btn btn-success"> OK </a>

	<ul class="controls" id="altField"> </ul>

	

	<a href="@routes.Application.heureSelection(event.id)" class="btn btn-primary">Continuer</a>

	<div id="dialog-check-pwd-adm" title="Entrez le mot de passe organisateur">				
			<label for="password">Mot de passe organisateur (envoyé par mail a la création de l'évènement) :</label>
			<input type="password" name="password" id="password-check-adm" value="" class="text ui-widget-content ui-corner-all" />
		
	</div>



	<script type="text/javascript" charset="utf-8">

		$(function(){



			$( "#date" ).multiDatesPicker();

			$( "#date" ).datepicker( "option", "minDate", 0);

			$("#date").multiDatesPicker({				
				onSelect: function(date) {
					$( "#date" ).datepicker( "option", "minDate", 0);
					var selectionType = $.inArray(date, $( "#date" ).multiDatesPicker('getDates'));
					//alert(date);
					var d = new Date(date);		
					var dateText = d.toLocaleDateString();	
					
					if (selectionType != -1) {	
						$.ajax({
							type: "POST",
							url: "@routes.Application.addDate(id)",
							data: '{"date" : "' + dateText + '"}',
							contentType: "application/json",
							success : function(data) {											
								ajouterDate(date, data.idJour);							
							}
						});	
					} else {					
						$.ajax({
							type: "POST",
							url: "@routes.Application.removeDate(id)",
							data: '{"idDate" : "' + $("li:contains("+dateText+")").attr("id") + '"}',
							contentType: "application/json",
							success : function(data) {
								
							}
						});	
						$("li:contains("+dateText+")").remove();
					} 
				}
			});
		});

		$("#okParticuliere").live("click", function() {
			$.ajax({
				type: "POST",
				url: "@routes.Application.addDate(id)",
				data: '{"date" : "' + $(".particuliere").val() + '"}',
				contentType: "application/json",
				success : function(data) {											
					$("#altField").append(
						"<li id=\""+data.idJour+"\">"+
						"<a class=\"linkDate\" name=\""+$(".particuliere").val()+"\">"+
						"<i class=\"mesicones icon-trash\"></i>&nbsp;"+
						"</a>"+$(".particuliere").val()+	
						"</li>"
					);	

				}
			});	
		})

		function ajouterDate(dateText, id) {			
			var d = new Date(dateText);		
			var date = d.toLocaleDateString();
			$("#altField").append(
				"<li id=\""+id+"\">"+
				"<a class=\"linkDate datepicker\" name=\""+dateText+"\">"+
				"<i class=\"mesicones icon-trash\"></i>&nbsp;"+
				"</a>"+date+	
				"</li>"
			);
		}	

		$('.linkDate').live('click', function(e) {	
			if ($(this).hasClass("datepicker")) {
				$("#date").multiDatesPicker('removeDates', $(this).attr("name")); //enleve la date dans l'affichage du datepicker
			}
			$(this).parent().remove();

			/*SUPPRESSION DE DATE*/			
			$.ajax({
				type: "POST",
				url: "@routes.Application.removeDate(id)",
				data: '{"idDate" : "' + $(this).parent().attr("id") + '"}',
				contentType: "application/json",
				success : function(data) {
					
				}
			});	

		});




	$(function(){		

		$( "#dialog-check-pwd-adm" ).dialog( "open" );		

	});
	

	$( "#dialog-check-pwd-adm" ).dialog({  // boite de dialogue personnalisée
		autoOpen: false,
		height: 200,
		width: 275,
		modal: true,
		open: function(event, ui) { $(".ui-dialog-titlebar-close", $(this).parent()).hide(); },
		closeOnEscape: false,
		buttons: {
			"OK": function() {				
								
				pass = $("#password-check-adm").val();	
				if (pass == "@event.passAdmin") {
				  	$( this ).dialog( "close" );
				} else {
				  	alert("mot de passe incorrect");
				}				
				
			}					
		}
		
		
	});

	</script>
    
    
}